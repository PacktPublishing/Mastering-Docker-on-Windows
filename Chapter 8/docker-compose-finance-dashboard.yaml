version: "3.9"
services:
  finance-dashboard:
    image: finacr.azurecr.io/finance-dashboard:1.0.0
    ports:
      - "8080:80"
    secrets:
      - db_password
    environment:
      - DB_CONNECTION=Server=db.internal;Database=Loans;
    healthcheck:
      test: ["CMD", "powershell", "-Command", "Invoke-WebRequest -UseBasicParsing http://localhost/health"]
      interval: 30s
      timeout: 5s
      retries: 3

secrets:
  db_password:
    external: true
